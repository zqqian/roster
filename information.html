<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>个人信息</title>
    <script src="../js/jquery-3.2.1.js"></script>
</head>
<style>
</style>
<body>
<form action="login.php" method="post" id="reset" onsubmit="return validateForm( );">
    <span>用户名</span><input type="text" id="username" value=""><br>
    <span>邮箱</span><input type="text" id="email" value=""><br>
    <span>学校</span><input type="text" id="school" value=""><br>
    <span>学院</span><input type="text" id="academy" value="">
    <input type="submit" id="tijniao" value="保存">
</form>
<script>
    $(function(){
        var username;
        var email;
        var school;
        var academy;
        var userId=session.getAttribute("userID").toString(); //取出后台存入session的值用户Id
        $.post("information.php",{userId:userId},function(data){
            var data=data.split(",");
            username=data[0];
            email=data[1];school=data[2];academy=data[3];
            $("#username").val(username);
            $("#email").val(email);
            $("#school").val(school);
            $("#academy").val(academy);
        })
        $("#tijiao").disabled=true;
        var form=document.getElementById('reset');
        for(var i=0;i<form.length;i++)
        {
            var element=form.elements[i];
            if(element.value!=element.defaultValue)
            {
                $("#tijiao").disabled=false;
                break;
            }
        }
        function validateForm()
        {
            var username=$("#username").val();
            var email=$("#email").val();
            if(username==""||email=="")
            {
                alert("用户名或密码不能为空")
                return false;
            }
            else {
                var reg = /^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/;
                isok = reg.test(email);
                if (!isok) {
                    alert("邮箱格式不正确，请重新输入");
                    document.getElementById("email").focus();
                    return false;
                }
                $.post("information.php", {username: $("#username").val()}, function (data) {
                    if (data) {
                        alert("修改成功！")
                        return true;
                    }
                    else {
                        alert("用户名重复，请重新设置用户名!")
                        return false;
                    }
                })
            }
        }
    })
</script>
</body>
</html>